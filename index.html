<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>××©×—×§ ×”×›×ª×‘×” â€“ ×—×•×¨×£</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #e3f2fd;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

.card {
  background: white;
  padding: 20px;
  max-width: 520px;
  width: 92%;
  border-radius: 16px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  text-align: center;
}

input {
  width: 100%;
  padding: 10px;
  font-size: 1.2rem;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-top: 10px;
}

button {
  padding: 10px 16px;
  margin: 6px;
  border-radius: 20px;
  cursor: pointer;
  border: none;
  background: #2196f3;
  color: white;
  font-size: 1rem;
}

button:disabled {
  opacity: 0.5;
}

.feedback.success { color: green; }
.feedback.error { color: red; }

#hud {
  display:flex;
  justify-content:space-between;
  margin-top:10px;
  font-size:0.9rem;
}

#wordsStats {
  margin-top: 6px;
  font-size: 0.9rem;
}

#certificate {
  display:none;
  margin-top:16px;
  padding:16px;
  border:3px double #333;
  border-radius:12px;
  background:#fffdf5;
}
</style>
</head>

<body>
<div class="card">

<h2 id="title">××©×—×§ ×”×›×ª×‘×” â€“ ×—×•×¨×£ â„ï¸</h2>

<!-- ××¡×š ×©× -->
<div id="nameScreen">
  <p>××” ×”×©× ×©×œ×š?</p>
  <input id="playerNameInput" placeholder="×©×">
  <button onclick="startGameFromName()">×”×ª×—×™×œ ××©×—×§ â–¶ï¸</button>
</div>

<!-- ××¡×š ××©×—×§ -->
<div id="gameScreen" style="display:none">

<div id="hud">
  <div>â± <span id="timer">0</span></div>
  <div>â­ ×©×œ×‘ <span id="level">1</span></div>
  <div>ğŸ¯ <span id="score">0/0</span></div>
</div>

<div id="wordsStats">
  ××™×œ×™× × ×›×•× ×•×ª: <span id="completed">0</span> / <span id="total">0</span>
</div>

<input id="answerInput" placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×”××™×œ×”" disabled>

<div>
  <button onclick="speak()">×”×©××¢×” ğŸ§</button>
  <button onclick="check()">×‘×“×™×§×” âœ…</button>
  <button onclick="nextWord(true)">×“×œ×’ ğŸ”„</button>
</div>

<div id="feedback"></div>

<div id="certificate">
  <h3>ğŸ“ ×ª×¢×•×“×ª ×”×¦×˜×™×™× ×•×ª</h3>
  <p>
    ×›×œ ×”×›×‘×•×“ <strong><span id="certName"></span></strong><br>
    ×¡×™×™××ª ××ª ×›×œ ×”××™×œ×™× ×‘×œ×™ ××£ ×˜×¢×•×ª!
  </p>
  <button onclick="window.print()">×”×“×¤×¡ ğŸ–¨ï¸</button>
  <button onclick="sendSMS()">×©×œ×— SMS ğŸ“²</button>
</div>

</div>
</div>

<script>
// ××•×¦×¨ ××™×œ×™× â€“ ×—×•×¨×£
const ALL_WORDS = [
  "×¢× × ×™×","×¨×˜×•×‘","×’×©×","×©×œ×•×œ×™×ª","×§×•×¨","×—×•×",
  "××–×œ","××˜×¨×™×","×¦×œ×™×œ","×¡×•×›×¨","××˜×¨×™×”",
  "×‘×•×¥","×¦××¨","×›×•×‘×¢","×©×œ×’","×—×","×§×¨×—"
];

let mainQueue = [];
let errorQueue = [];
let reviewingErrors = false;
let current = "";

let total = 0;
let correct = 0;
let level = 1;
let timeLeft = 0;
let timerId = null;
let locked = false;
let playerName = "";
let allCorrect = true;
let uniqueCorrect = new Set();

const answerInput = document.getElementById("answerInput");
const feedback = document.getElementById("feedback");

document.getElementById("total").textContent = ALL_WORDS.length;

function shuffle(arr) {
  return [...arr].sort(() => Math.random() - 0.5);
}

function startGameFromName() {
  playerName = document.getElementById("playerNameInput").value.trim();
  if (!playerName) return alert("×›×ª×•×‘ ×©×");
  document.getElementById("title").textContent = "××©×—×§ ×”×›×ª×‘×” ×©×œ " + playerName;
  document.getElementById("nameScreen").style.display = "none";
  document.getElementById("gameScreen").style.display = "block";
  startGame();
}

function startGame() {
  mainQueue = shuffle(ALL_WORDS);
  errorQueue = [];
  reviewingErrors = false;
  uniqueCorrect.clear();
  total = correct = 0;
  level = 1;
  allCorrect = true;
  nextWord(false);
}

function speak() {
  if (!current) return;
  const u = new SpeechSynthesisUtterance(current);
  u.lang = "he-IL";
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

function startTimer() {
  clearInterval(timerId);
  timeLeft = Math.max(8, 18 - (level-1)*2);
  document.getElementById("timer").textContent = timeLeft;
  timerId = setInterval(() => {
    timeLeft--;
    document.getElementById("timer").textContent = timeLeft;
    if (timeLeft <= 0) timeUp();
  }, 1000);
}

function nextWord(skipped) {
  clearInterval(timerId);
  if (skipped && current) errorQueue.push(current);

  if (mainQueue.length === 0) {
    if (!reviewingErrors && errorQueue.length) {
      reviewingErrors = true;
      mainQueue = shuffle(errorQueue);
      errorQueue = [];
    } else if (reviewingErrors && errorQueue.length === 0) {
      finishGame();
      return;
    }
  }

  current = mainQueue.shift();
  locked = false;
  answerInput.disabled = false;
  answerInput.value = "";
  feedback.textContent = "";
  speak();
  startTimer();
}

function timeUp() {
  if (locked) return;
  locked = true;
  total++;
  allCorrect = false;
  feedback.textContent = "â± × ×’××¨ ×”×–××Ÿ â€“ " + current;
  feedback.className = "feedback error";
  errorQueue.push(current);
  setTimeout(()=>nextWord(false),1500);
}

function check() {
  if (locked) return;
  locked = true;
  clearInterval(timerId);
  total++;
  const val = answerInput.value.trim();
  if (val === current) {
    correct++;
    uniqueCorrect.add(current);
    feedback.textContent = "âœ” ×›×œ ×”×›×‘×•×“!";
    feedback.className = "feedback success";
  } else {
    allCorrect = false;
    feedback.textContent = "âœ– ×”××™×œ×”: " + current;
    feedback.className = "feedback error";
    errorQueue.push(current);
  }

  document.getElementById("score").textContent = correct + "/" + total;
  document.getElementById("completed").textContent = uniqueCorrect.size;
  setTimeout(()=>nextWord(false),1500);
}

function finishGame() {
  if (allCorrect && uniqueCorrect.size === ALL_WORDS.length) {
    document.getElementById("certName").textContent = playerName;
    document.getElementById("certificate").style.display = "block";
  } else {
    feedback.textContent = "×¡×™×™××ª! × ×¡×” ×©×•×‘ ×›×“×™ ×œ×§×‘×œ ×ª×¢×•×“×” ğŸ™‚";
  }
}

function sendSMS() {
  const msg = "×›×œ ×”×›×‘×•×“! ×¡×™×™××ª×™ ××©×—×§ ×”×›×ª×‘×” ×‘×œ×™ ×˜×¢×•×™×•×ª ğŸ‰";
  location.href = "sms:?&body=" + encodeURIComponent(msg);
}
</script>
</body>
</html>
